# Express with ES6 (RestAPI) - Defect Machine

An skeleton express app that allows you to use ES6 syntax. Generated by express-generator cli.

## How to run

Before anything else, you must have node installed on your machine.

### Config Environments such as Database connection info, port and etc

In root of project `config` folder you can change envs as dev,prod,stag,test

Before run server you must config Postgresql server configuration info in `config => development.json`:

```
database:{
  "host": "localhost",
  "user": "postgres",
  "password": "123456",
  "database": "NodeJsDb",
  "port":"5432"
}
```

### Project Structure : Domain Driven + OOP + SOLID

```
Request life cycle;

    requestA fire +++>>> api/v1/defect
    --> Validation by Joi libraries as middleware in routes config;
    ---> After pass by validation process handleing by Controller
    ----> All of exception handle in this layer to CustomExceptionHandler as middleware
          (send a full friendly error detail to response) 
    -----> if there is not error 
    ------> Request sent to PresentionLayer as Logic and Process all logic flow on request 
    ------->  PresentionLayer for do all transaction use defectService, machineService and etc as services
    --------> Services communicated with DomainLayer Or Data as Repositories like defectRepository, machineRepository
    ---------> All of Data Logic must be handle by repositories 
    ----------> Repositories use DbManager to do transaction like CRUD on Database
    
    Mapping Classes From DomainLayer (Data) to PresentationLayer (View):
     ---> mapped ViewModel (ApiResponseModel) to DbModel (QueryResultModel)
   
    Mapping Classes From PresentationLayer (View) to DomainLayer (Data):
     ---> mapped DbModel (QueryResultModel) to ViewModel (ApiResponseModel)
    
    Done!
```

### Init Database 

Use SQL Create Queries in `src/domain/data/example-db.sql` to create your Postgresql DB

### Running Dev Server

Add `"type":"module"` to package.json file and after stop Dev Server for build should remove it.

Then, run on your terminal `npm run watch:dev`, the server will restart everytime you make a change in your code.

Or if you want without watching you can run on your terminal `npm-run-all build server`

### Running Unit Tests (Jest)

#### -Unit-Tests:
Run on your terminal `npm test-unit`.

#### -Integration-Tests:
Run on your terminal `npm test-integration`.

Also, You can see coverage of test in `coverage` folder of root project


### Running Production Server

For stuff like heroku deployment, aws elasticbeanstalk, run `npm run start`

### Logs Service (Winston)

All logs as Debug, Info, Error, Warning generate on Logs folder as file when project run

### Use Postman for communicate with API

`Defect.postman_collection.json`

### Other scripts

* `transpile` - convert es6 and beyond code to es5 to a folder named `dist-server`
* `clean` - delete transpiled folder
* `build` - clean and transpile
* `server` - start transpile code
